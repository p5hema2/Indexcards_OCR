---
phase: 06-merge-features-of-main-and-current-branch-with-interview-which-feature-to-pick
plan: 08
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/frontend/src/features/results/ResultsTable.tsx
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "EditableCell renders <textarea> with auto-resize for multiline editing"
    - "No duplicate filename column — only the Image column shows the filename"
    - "Column order is: Image, Status, Time/Duration, Extraction (widest column last)"
  artifacts:
    - path: "apps/frontend/src/features/results/ResultsTable.tsx"
      provides: "Fixed EditableCell, removed filename column, reordered columns"
      contains: "textarea"
  key_links:
    - from: "EditableCell"
      to: "textarea element"
      via: "ref typed as HTMLTextAreaElement"
      pattern: "HTMLTextAreaElement"
---

<objective>
Close three UAT gaps in ResultsTable: (1) switch EditableCell from input to auto-resizing textarea for multiline values, (2) remove the redundant filename column since ThumbnailCell already displays the filename, (3) reorder columns so Time/Duration comes before Extraction.

Purpose: Resolve UAT Tests 1 (major), 5 (minor), and 7 (cosmetic) from 06-UAT.md.
Output: Updated ResultsTable.tsx with all three fixes applied.
</objective>

<execution_context>
@/Users/martinhess/.claude/get-shit-done/workflows/execute-plan.md
@/Users/martinhess/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-merge-features-of-main-and-current-branch-with-interview-which-feature-to-pick/06-07-SUMMARY.md
@apps/frontend/src/features/results/ResultsTable.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Convert EditableCell from input to auto-resizing textarea</name>
  <files>apps/frontend/src/features/results/ResultsTable.tsx</files>
  <action>
In the EditableCell component (lines 48-93 of ResultsTable.tsx), make these changes:

1. Change `useRef<HTMLInputElement>(null)` to `useRef<HTMLTextAreaElement>(null)` (line 51).

2. Replace the `<input>` element (lines 69-79) with a `<textarea>`:
   - Same className but add `resize-none overflow-hidden` for clean auto-resize.
   - Remove the `onKeyDown` handler that commits on Enter. Instead:
     - Ctrl+Enter or Cmd+Enter commits (calls commit()).
     - Escape resets draft and exits editing.
     - Plain Enter inserts a newline (default textarea behavior — no handler needed).
   - Add auto-resize on mount and on change: set `textarea.style.height = 'auto'` then `textarea.style.height = textarea.scrollHeight + 'px'` in both the useEffect (when editing starts) and the onChange handler.
   - Keep rows={1} as the minimum so it starts small for single-line values.

3. In the display mode (lines 83-92), ensure the value renders with `whitespace-pre-wrap` so multiline values show their line breaks. Add `whitespace-pre-wrap` to the className of the `<span>` (line 86). The existing `whitespace-pre-line` class if present should be changed to `whitespace-pre-wrap`.

4. Add a title/hint to the display span: keep existing title but for edit mode, update the textarea placeholder or add a small hint. Minimal: just ensure the textarea has a `placeholder="Enter value..."` attribute.
  </action>
  <verify>Run `cd /Users/martinhess/workspace/hack-the-heritage/Indexcards_OCR && npx turbo typecheck` — must pass with zero errors. Grep ResultsTable.tsx for "textarea" to confirm presence; grep for "<input" to confirm no input elements remain in EditableCell.</verify>
  <done>EditableCell renders textarea for editing with auto-resize behavior. Ref typed as HTMLTextAreaElement. Ctrl+Enter commits, Escape cancels, plain Enter creates newlines. Display mode uses whitespace-pre-wrap for multiline rendering.</done>
</task>

<task type="auto">
  <name>Task 2: Remove filename column and reorder Duration before Extraction</name>
  <files>apps/frontend/src/features/results/ResultsTable.tsx</files>
  <action>
In the columns array of ResultsTable (starts around line 152):

1. **Remove the filename column entirely** (currently id: 'filename', lines 169-195). The ThumbnailCell in the Image column already displays the filename as a text link. For multi-entry sub-rows that showed entry labels (e.g. "Eintrag 2 / 7"), move the entry label display into the thumbnail column:
   - In the thumbnail column cell renderer, for sub-rows (r._isSubRow === true), instead of rendering just a border-left connector span, render the entry label badge: `<span className="font-mono text-xs text-archive-sepia/70 bg-archive-sepia/10 rounded px-1.5 py-0.5 ml-3">Eintrag {r._entryLabel}</span>`.
   - For primary rows that have _entryLabel (multi-entry first row), append the entry label below the ThumbnailCell: wrap in a flex-col and add the entry label badge beneath.

2. **Reorder columns** so the final order is:
   - Column 1: thumbnail (Image)
   - Column 2: status (Status)
   - Column 3: duration (Time)
   - Column 4: extraction (Extraction — widest, goes last)

   Move the duration column definition to come BEFORE the extraction column definition in the array. Move the status column definition to come right after thumbnail (before duration).

3. Update column header comments to reflect new numbering (Column 1, 2, 3, 4).
  </action>
  <verify>Run `cd /Users/martinhess/workspace/hack-the-heritage/Indexcards_OCR && npx turbo typecheck` — must pass with zero errors. Grep for `id: 'filename'` in ResultsTable.tsx — must return zero matches. Verify column order in the array matches: thumbnail, status, duration, extraction.</verify>
  <done>Filename column removed. Column order is Image, Status, Time, Extraction. Entry labels for multi-entry rows are shown within the Image column. Table has 4 columns instead of 5.</done>
</task>

</tasks>

<verification>
1. `npx turbo typecheck` passes with zero errors across all packages.
2. No `<input` elements in EditableCell — only `<textarea`.
3. No column with `id: 'filename'` in the columns array.
4. Column array order: thumbnail, status, duration, extraction.
5. `HTMLTextAreaElement` ref type in EditableCell.
6. `whitespace-pre-wrap` on EditableCell display span.
</verification>

<success_criteria>
- UAT Test 1 (major): Value fields use textarea for multiline editing; display mode preserves line breaks.
- UAT Test 5 (minor): No duplicate filename column; Image column is the sole filename display.
- UAT Test 7 (cosmetic): Time/Duration column appears before Extraction column.
- TypeScript compiles cleanly.
</success_criteria>

<output>
After completion, create `.planning/phases/06-merge-features-of-main-and-current-branch-with-interview-which-feature-to-pick/06-08-SUMMARY.md`
</output>
