---
phase: 02-frontend-scaffold-configuration-react
plan: 02
type: execute
wave: 2
depends_on: ["02-01"]
files_modified: [
  "frontend/src/features/upload/UploadStep.tsx",
  "frontend/src/features/upload/Dropzone.tsx",
  "frontend/src/features/upload/FileList.tsx",
  "frontend/src/api/uploadApi.ts",
  "frontend/src/store/wizardStore.ts"
]
autonomous: true
requirements: [FRONTEND-03, FRONTEND-05]
user_setup: []

must_haves:
  truths:
    - "User can drag-and-drop or select files for upload"
    - "Uploaded files appear in a List View with metadata"
    - "File counter shows 'X Files | Y MB' accurately"
    - "User can delete a file with confirmation"
    - "Unsupported formats trigger an error state and Toast"
  artifacts:
    - path: "frontend/src/features/upload/Dropzone.tsx"
      provides: "React Dropzone integration for image files"
    - path: "frontend/src/features/upload/FileList.tsx"
      provides: "List view with file name, size, and deletion actions"
    - path: "frontend/src/api/uploadApi.ts"
      provides: "TanStack Query mutation to call /api/v1/upload/"
  key_links:
    - from: "frontend/src/features/upload/UploadStep.tsx"
      to: "frontend/src/api/uploadApi.ts"
      via: "useMutation hook"
    - from: "frontend/src/features/upload/UploadStep.tsx"
      to: "frontend/src/store/wizardStore.ts"
      via: "useWizardStore hook"
---

<objective>
Implement Step 1 (Upload) of the wizard, enabling users to drag & drop index card images, view them in a list with metadata, and sync with the backend Upload API.

Purpose: Allow users to prepare their data batch for OCR processing.
Output: Working Upload step with Dropzone, List View, File Metadata, and Backend API integration.
</objective>

<execution_context>
@/Users/martinhess/.gemini/get-shit-done/workflows/execute-plan.md
@/Users/martinhess/.gemini/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-frontend-scaffold-configuration-react/2-RESEARCH.md
@.planning/2-CONTEXT.md
@.planning/phases/02-frontend-scaffold-configuration-react/02-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement Upload Dropzone and List View</name>
  <files>frontend/src/features/upload/Dropzone.tsx, frontend/src/features/upload/FileList.tsx, frontend/src/features/upload/UploadStep.tsx</files>
  <action>
    - **Dropzone:** Use `react-dropzone` to create an upload area. Restrict to common image types (JPG, PNG, WEBP).
    - **List View:** Display uploaded files in a list (as decided in CONTEXT.md). Each row should show: filename, file size, and an 'X' button for removal.
    - **Metadata:** Update the `wizardStore.ts` to hold the list of selected files and calculate the total count and total cumulative size.
    - **Visuals:** Apply the 'Parchment' theme to the list rows and use 'archive-sepia' for hover effects.
  </action>
  <verify>Drag 3 images into the dropzone. Verify they appear in a list with correct file names and sizes.</verify>
  <done>Upload UI is functional with list view and basic file management.</done>
</task>

<task type="auto">
  <name>Task 2: Integrate Backend Upload API with TanStack Query</name>
  <files>frontend/src/api/uploadApi.ts, frontend/src/features/upload/UploadStep.tsx</files>
  <action>
    - Create `uploadApi.ts` using Axios and TanStack Query's `useMutation`.
    - Implement a function `uploadFiles` that calls the Backend's `POST /api/v1/upload/` endpoint.
    - Wire the Dropzone's `onDrop` to trigger the upload mutation.
    - Update the `wizardStore.ts` with the `session_id` (or similar batch identifier) returned from the backend.
  </action>
  <verify>Upload a file and check the Network tab to confirm a successful POST to `/api/v1/upload/` with a 201 Created status.</verify>
  <done>Frontend is successfully sending files to the FastAPI backend.</done>
</task>

<task type="auto">
  <name>Task 3: Add Deletion Confirmation and Error Toasts</name>
  <files>frontend/src/features/upload/FileList.tsx, frontend/src/features/upload/UploadStep.tsx</files>
  <action>
    - Use `sonner` for toast notifications.
    - Implement a simple confirmation dialog (or a "Confirm Delete" toggle) for file removal from the list.
    - Add logic to visually mark unsupported file types if they somehow bypass the dropzone filter (e.g., with a red border/text).
    - Show a toast if a file is too large (as per CONTEXT.md).
    - Update the footer live stats in `MainLayout` by reading from the `wizardStore.ts`.
  </action>
  <verify>Try to delete a file and verify the confirmation appears. Check that the footer stats update in real-time as files are added/removed.</verify>
  <done>User interaction polish (confirmation and feedback) is complete.</done>
</task>

</tasks>

<verification>
- Verify files are uploaded successfully to the backend.
- Verify file count and size are accurate in the footer.
- Verify that 'Start Fresh' clears the uploaded files and session.
</verification>

<success_criteria>
- User can successfully upload multiple images.
- Files are correctly listed and manageable.
- Backend synchronization (session_id) is established.
</success_criteria>

<output>
After completion, create `.planning/phases/02-frontend-scaffold-configuration-react/02-02-SUMMARY.md`
</output>
