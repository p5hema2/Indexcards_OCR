---
phase: 02-frontend-scaffold-configuration-react
plan: 02
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - frontend/src/features/upload/UploadStep.tsx
  - frontend/src/features/upload/Dropzone.tsx
  - frontend/src/features/upload/FileList.tsx
  - frontend/src/api/uploadApi.ts
  - frontend/src/store/wizardStore.ts
autonomous: true
requirements:
  - FRONTEND-03
  - FRONTEND-05
user_setup: []

must_haves:
  truths:
    - "User can drag-and-drop or click to select multiple index card images"
    - "Selected images are displayed in a 'List View' (rows) with name and size"
    - "The footer updates live with 'X Files | Y MB' reflecting the selection"
    - "Deleting a file from the list triggers a confirmation toast/modal"
    - "Uploading images returns a 'session_id' (or batch ID) from the backend"
  artifacts:
    - path: "frontend/src/features/upload/Dropzone.tsx"
      provides: "React Dropzone component restricted to image formats (JPG, PNG, WEBP)"
    - path: "frontend/src/features/upload/FileList.tsx"
      provides: "Parchment-themed list view for uploaded files with removal actions"
    - path: "frontend/src/api/uploadApi.ts"
      provides: "Axios client and TanStack Query mutation for POST /api/v1/upload/"
  key_links:
    - from: "frontend/src/features/upload/UploadStep.tsx"
      to: "frontend/src/api/uploadApi.ts"
      via: "useMutation to sync files with the backend"
    - from: "frontend/src/features/upload/UploadStep.tsx"
      to: "frontend/src/store/wizardStore.ts"
      via: "useWizardStore to update global file list and session ID"
---

<objective>
Implement Step 1 (Upload) of the wizard, enabling users to add index card images, view them in a structured list with metadata, and sync the batch with the backend Upload API.

Purpose: Provide a reliable and user-friendly way to stage image batches for OCR processing.
Output: Working Upload step with Dropzone, List View, Metadata tracking, and Backend API integration.
</objective>

<execution_context>
@/Users/martinhess/.gemini/get-shit-done/workflows/execute-plan.md
@/Users/martinhess/.gemini/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-frontend-scaffold-configuration-react/2-RESEARCH.md
@.planning/phases/02-frontend-scaffold-configuration-react/02-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build Upload Dropzone and List View UI</name>
  <files>
    - frontend/src/features/upload/Dropzone.tsx
    - frontend/src/features/upload/FileList.tsx
    - frontend/src/features/upload/UploadStep.tsx
  </files>
  <action>
    - **Dropzone:** Use `react-dropzone` to create a prominent upload area. Restrict to image file types and handle large files by showing a `sonner` toast if they exceed 10MB (as per RESEARCH.md).
    - **FileList:** Create a 'List View' (as decided in CONTEXT.md) where each row shows the filename, file size, and a 'Delete' (X) button with a confirmation step (e.g., small popup or double-click to confirm).
    - **Wizard Integration:** Update the `wizardStore.ts` `files` array when new files are added.
  </action>
  <verify>Drag 3 JPG images into the dropzone and verify they appear as 3 rows in the list with correct metadata.</verify>
  <done>Upload interface is functional with file listing and basic metadata visualization.</done>
</task>

<task type="auto">
  <name>Task 2: Integrate Backend Upload API (TanStack Query)</name>
  <files>
    - frontend/src/api/uploadApi.ts
    - frontend/src/features/upload/UploadStep.tsx
    - frontend/src/store/wizardStore.ts
  </files>
  <action>
    - Implement `uploadApi.ts` with a `useUploadMutation` using TanStack Query.
    - Function should call `POST /api/v1/upload/` using `FormData`.
    - Handle the response (which returns a `session_id`) and store it in the `wizardStore.ts`.
    - Show success/error toasts using `sonner` for the upload process.
  </action>
  <verify>Check the browser's Network tab and confirm a successful POST to `/api/v1/upload/` when files are dropped, returning a 201 Created status.</verify>
  <done>Frontend and Backend are synchronized via the Upload API.</done>
</task>

<task type="auto">
  <name>Task 3: Refine Metadata and Footer Stats</name>
  <files>
    - frontend/src/components/Footer.tsx
    - frontend/src/store/wizardStore.ts
  </files>
  <action>
    - Implement a derived state or computed selector in `wizardStore.ts` to calculate total file count and cumulative size in MB.
    - Update `Footer.tsx` to read these values and display them (e.g., "15 Files | 45.2 MB").
    - Ensure the 'Next' button in `UploadStep` is only enabled if at least one file has been successfully staged/uploaded.
  </action>
  <verify>Verify that the footer updates in real-time as files are added or removed from the upload list.</verify>
  <done>Live statistics are accurately displayed and control the workflow progression.</done>
</task>

</tasks>

<verification>
- Verify that multiple files can be uploaded in one batch.
- Verify that the 'Delete' confirmation prevents accidental removal.
- Verify that unsupported file formats are visually rejected (marked with an error toast).
</verification>

<success_criteria>
- File drop results in an immediate list view update.
- Files are successfully sent to the FastAPI backend and a `session_id` is received.
- Footer accurately reflects the staged batch size.
- Navigation to Step 2 is enabled only after files are added.
</success_criteria>

<output>
After completion, create `.planning/phases/02-frontend-scaffold-configuration-react/02-02-SUMMARY.md`
</output>
