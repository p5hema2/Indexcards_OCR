# Phase 02.1: Add Turbo - Context

**Gathered:** 2026-02-21
**Status:** Ready for planning

<domain>
## Phase Boundary

Set up Turborepo to manage the frontend (React/Vite) and backend (FastAPI/Python) as a monorepo with unified dev commands, shared scripts, task orchestration, and a shared types package. Restructure the repo from flat frontend/backend/ to the apps/ + packages/ Turbo convention.

</domain>

<decisions>
## Implementation Decisions

### Dev Workflow
- `turbo dev` starts both Vite (frontend) and uvicorn (backend) in parallel by default
- Allow filtering: `turbo dev --filter=frontend` or `turbo dev --filter=backend` to run individually
- Single shared `.env` file at repo root, both packages read from it
- Per-package installs with root-level orchestration (not hoisted node_modules)
- Backend integrates via thin `package.json` wrapper — npm scripts call pip/uvicorn under the hood
- Port conflicts: fail with a clear error message showing which port is occupied
- Python venv auto-managed: root setup script creates venv and installs requirements automatically
- `turbo build` runs Vite build (frontend) + Python typecheck/lint (backend "build" task)
- `turbo test` runs vitest (frontend) + pytest (backend) in parallel
- `turbo typecheck` runs tsc (frontend) + mypy/pyright (backend)

### Package Structure
- Top-level layout: `apps/frontend`, `apps/backend`, `packages/`
- Shared types package: `packages/shared-types` with API request/response contracts
- Cross-language type generation: single source of truth (e.g., JSON Schema) generates both TypeScript interfaces and Pydantic models
- Legacy files (indexcard_ocr.py, data/, etc.) move to `apps/legacy/`

### Script Orchestration
- Local caching only (`.turbo/`), no remote cache
- Full command set: `dev`, `build`, `test`, `lint`, `typecheck`, `clean`, `format`, `install`/`setup`
- `turbo lint` runs ESLint (frontend) + ruff/flake8 (backend) in parallel
- Strict task dependency pipeline: typecheck before build, lint independent, test after build
- `turbo format` runs Prettier (frontend) + Black (backend)

### Migration Approach
- Preserve git history using `git mv` when moving frontend/ and backend/ into apps/
- Single atomic commit for the entire restructure
- Scan repo for hardcoded path references before migration (user unsure if CI/Docker/scripts exist)
- Root-level legacy files move to `apps/legacy/`

### Claude's Discretion
- Dev output formatting (use Turbo's built-in package-prefixed output)
- Clean command scope (cache vs. full wipe)
- Additional shared packages beyond types (e.g., shared ESLint/Prettier config)
- Python version manager choice (pick one compatible with future exe/dmg/Docker packaging)
- Exact task dependency graph design

</decisions>

<specifics>
## Specific Ideas

- Future packaging goal: project will eventually be bundled as exe, dmg, or Docker container for deployment — Python tooling choices should not lock out any of these options
- Backend package.json is a thin wrapper — npm scripts delegate to Python tooling (pip, uvicorn, pytest, mypy, ruff)
- Single source of truth for API types: JSON Schema (or similar) generates both TS and Pydantic models to prevent drift

</specifics>

<deferred>
## Deferred Ideas

- Remote caching (Vercel Remote Cache) — add later if CI gets slow
- Docker packaging — Phase 5 scope
- exe/dmg bundling — Phase 5 scope

</deferred>

---

*Phase: 02.1-add-turbo*
*Context gathered: 2026-02-21*
