---
phase: 02.1-add-turbo
plan: 02
subsystem: infra
tags: [turborepo, npm-workspaces, uv, python, venv, monorepo, package-json, port-detection]

# Dependency graph
requires:
  - phase: 02.1-add-turbo
    plan: 01
    provides: "apps/frontend and apps/backend directories in Turborepo monorepo layout with root package.json and turbo.json"
provides:
  - "apps/backend/package.json as @indexcards/backend thin npm wrapper"
  - "apps/backend/.python-version pinning Python 3.12 for uv"
  - "apps/backend/requirements-dev.txt with mypy/ruff/black/pytest/datamodel-code-generator"
  - "apps/frontend/package.json as @indexcards/frontend with full turbo task scripts"
  - "apps/frontend/package.json with @indexcards/shared-types workspace dependency"
  - "scripts/setup.mjs for one-command project bootstrap (uv + npm)"
affects:
  - "02.1-03 (packages/shared-types setup - depends on @indexcards/shared-types in frontend)"
  - "all turbo run commands (backend now discoverable as workspace)"
  - "npm run setup (setup.mjs is now wired to root package.json)"

# Tech tracking
tech-stack:
  added:
    - "prettier ^3.5.0 (frontend devDependency)"
    - "datamodel-code-generator (Python dev dep via requirements-dev.txt)"
    - "mypy, ruff, black, pytest (Python dev deps via requirements-dev.txt)"
  patterns:
    - "Thin npm wrapper pattern: backend package.json delegates all scripts to uv run"
    - "Port conflict detection via Node net.createServer inline in dev scripts"
    - "uv pip install -r requirements-dev.txt includes -r requirements.txt for transitive production deps"
    - "setup.mjs ES module with import.meta.dirname for portable repo-root resolution"

key-files:
  created:
    - "apps/backend/package.json (@indexcards/backend with uv run delegation)"
    - "apps/backend/.python-version (Python 3.12 pin)"
    - "apps/backend/requirements-dev.txt (mypy/ruff/black/pytest/datamodel-code-generator)"
    - "scripts/setup.mjs (Python venv + npm workspace bootstrap)"
  modified:
    - "apps/frontend/package.json (renamed to @indexcards/frontend, added typecheck/format/clean/test scripts, port detection, shared-types dep, prettier devDep)"

key-decisions:
  - "Backend package.json has zero npm dependencies - all Python deps managed by uv via requirements.txt files"
  - "Port conflict detection uses Node net.createServer inline script to avoid shell portability issues"
  - "Frontend dev script wraps vite in port check instead of calling vite directly"
  - "test script in frontend is a placeholder echo - vitest added when tests are written"
  - "setup.mjs uses import.meta.dirname (Node 21.2+) for ESM-compatible root path resolution"

patterns-established:
  - "Pattern: Backend npm scripts always prefix commands with uv run for venv isolation"
  - "Pattern: Port conflict detection is part of dev script, not external tooling"
  - "Pattern: setup.mjs is the single entry point for new developer onboarding"

# Metrics
duration: 2min
completed: 2026-02-21
---

# Phase 02.1 Plan 02: Backend Package.json Wrapper Summary

**Thin npm wrapper for Python backend using uv run delegation, port conflict detection in both dev scripts, and one-command project bootstrap via scripts/setup.mjs.**

## Performance

- **Duration:** ~2 min
- **Started:** 2026-02-21T09:47:06Z
- **Completed:** 2026-02-21T09:48:29Z
- **Tasks:** 3
- **Files modified:** 5 (3 created for backend, 1 frontend update, 1 new setup script)

## Accomplishments

- Created `apps/backend/package.json` as `@indexcards/backend` workspace — all 7 turbo tasks (dev/build/test/lint/typecheck/format/clean) delegate to `uv run`
- Updated `apps/frontend/package.json` as `@indexcards/frontend` with all turbo tasks, port conflict detection, shared-types dependency, and Prettier
- Created `scripts/setup.mjs` that checks uv, creates Python venv, installs all dependencies, runs npm install, and warns about missing .env

## Task Commits

Each task was committed atomically:

1. **Task 1: Create backend thin package.json, .python-version, and requirements-dev.txt** - `3ff215e` (feat)
2. **Task 2: Update frontend package.json with workspace name, scripts, and shared-types dep** - `f138159` (feat)
3. **Task 3: Create root setup script for Python venv auto-management** - `f872869` (feat)

## Files Created/Modified

- `apps/backend/package.json` - Thin npm wrapper; name `@indexcards/backend`; all scripts delegate to `uv run`; port 8000 conflict detection in dev
- `apps/backend/.python-version` - Pins Python 3.12 for uv automatic version selection
- `apps/backend/requirements-dev.txt` - Dev dependencies: `-r requirements.txt` (transitive production deps) + mypy + ruff + black + pytest + datamodel-code-generator
- `apps/frontend/package.json` - Renamed to `@indexcards/frontend`; added typecheck/format/clean/test scripts; port 5173 conflict detection in dev; `@indexcards/shared-types: "*"` dependency; `prettier ^3.5.0` devDependency
- `scripts/setup.mjs` - Bootstrap script: checks uv, creates/reuses `.venv`, installs Python production + dev deps, runs `npm install`, warns if `.env` missing

## Decisions Made

- Backend package.json has zero npm dependencies (no `dependencies` or `devDependencies` keys) — avoids workspace hoisting conflicts; all Python deps flow through uv via requirements files
- Port conflict detection uses inline Node `net.createServer` rather than shell utilities — ensures cross-platform compatibility without bash-isms
- `test` script in frontend is `echo 'No tests yet'` placeholder — turbo will not fail when no test framework is installed; vitest gets wired when tests are written
- `setup.mjs` uses `import.meta.dirname` (Node 21.2+) for ESM-native root path resolution, consistent with project's `"type": "module"` root package

## Deviations from Plan

None - plan executed exactly as written.

## Issues Encountered

None.

## User Setup Required

None - no external service configuration required for this plan.

Developer workflow: run `npm run setup` from repo root after cloning. This will create the Python venv, install all dependencies (Python + npm), and validate the .env file.

## Next Phase Readiness

- Both `@indexcards/backend` and `@indexcards/frontend` are now full Turborepo workspaces with all required scripts
- `turbo run dev` will start both Vite (port 5173) and uvicorn (port 8000) in parallel
- `turbo run dev --filter=frontend` and `--filter=backend` filters work via workspace names
- `npm run setup` is fully wired and operational
- Plan 03 can proceed: `packages/shared-types/` needs `package.json` and TypeScript codegen setup; frontend already declares `@indexcards/shared-types: "*"` dependency

---
*Phase: 02.1-add-turbo*
*Completed: 2026-02-21*
