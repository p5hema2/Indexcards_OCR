---
status: resolved
phase: 03.1-dynamic-prompt-generation-from-field-definitions-with-configurable-prompt-template
source: 03.1-01-SUMMARY.md, 03.1-02-SUMMARY.md
started: 2026-02-22T16:00:00Z
updated: 2026-02-22T17:00:00Z
---

## Current Test

number: complete
name: UAT Complete
expected: n/a
awaiting: n/a

## Tests

### 1. Prompt Template Section Visible
expected: On the Configure step, a "Prompt Template" collapsible section appears below the Field Definitions list (right column). It should show a chevron icon and be collapsed by default.
result: issue
reported: "yes but the default prompt mentions Musik this could be wrong for other cards so the default prompt should not be for a distinct topic"
severity: major

### 2. Expand Shows Default Template
expected: Clicking the "Prompt Template" header expands the section. A textarea appears with the default German prompt text (starting with "Du bist ein Experte...") containing the `{{fields}}` placeholder. An "Edit | Preview" toggle is visible above the textarea.
result: pass

### 3. Live Preview with Fields Substituted
expected: Add at least 2 metadata fields (e.g., "Komponist", "Titel"). Then expand Prompt Template and click "Preview". The preview shows the full prompt with `{{fields}}` replaced by a numbered field list like "1. **Komponist**: Extrahiere den Wert..." and "2. **Titel**: Extrahiere den Wert...".
result: pass

### 4. Edit Custom Template and Preview
expected: Switch to "Edit" mode. Modify the template text (e.g., change the preamble or add custom instructions). Switch to "Preview" — the preview reflects your modified text with the current fields substituted in.
result: pass

### 5. Reset to Default
expected: After editing the template, a "Reset to default" link appears below the textarea. Clicking it restores the original German default prompt. The "Reset to default" link disappears.
result: pass

### 6. Template Save Preserves Prompt
expected: Edit the prompt template to something custom. Click "Save as Template", give it a name. Then select "Custom / Blank Slate" (clears everything). Now re-select the saved template from the Collection Type dropdown — the custom prompt template is restored in the editor alongside the fields.
result: fail
reported: "custom prompt not restored"
severity: major

### 7. Persistence Across Page Refresh
expected: Edit the prompt template to something custom. Refresh the browser page. Navigate back to Configure step — the custom prompt template is still there (persisted via localStorage).
result: pass

### 8. Batch Creation Sends Prompt Template (skip if no API key)
expected: With a custom prompt template set, click "Commence Processing" to create and start a batch. The batch's config.json in data/batches/ should contain a "prompt_template" key with your custom text. (Skip this test if backend is not running or no OpenRouter API key is configured.)
result: skip
reported: "No API key configured"

## Summary

total: 8
passed: 5
failed: 1
issues: 1
pending: 0
skipped: 1

## Gaps

- truth: "Default prompt template should be domain-agnostic, not specific to music index cards"
  status: resolved
  reason: "User reported: yes but the default prompt mentions Musik this could be wrong for other cards so the default prompt should not be for a distinct topic"
  severity: major
  test: 1
  artifacts: []
  missing: []
  debug_session: ""

- truth: "Template save must persist prompt_template and restore it on load"
  status: resolved
  reason: "template_service.py create_template() and update_template() do not pass prompt_template to Template constructor or saved dict"
  severity: major
  test: 6
  artifacts: ["apps/backend/app/services/template_service.py:41-50", "apps/backend/app/services/template_service.py:52-61"]
  missing: []
  debug_session: ""
